<u:UrsaView xmlns="https://github.com/avaloniaui"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
            xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
            mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
            xmlns:u="https://irihi.tech/ursa"
            xmlns:m="clr-namespace:Diary.App.Models"
            x:Class="Diary.App.Views.SettingsView"
            Padding="8">
    <!-- 一些事件 -->
    <Interaction.Behaviors>
        <EventTriggerBehavior EventName="Loaded">
            <InvokeCommandAction Command="{Binding ForceLoadCommand}" />
        </EventTriggerBehavior>
    </Interaction.Behaviors>

    <!-- 模板 -->
    <u:UrsaView.DataTemplates>
        <DataTemplate DataType="{x:Type m:SettingGroup}">
            <Expander IsExpanded="True">
                <Expander.Header>
                    <TextBlock Classes="SectionHeader" Text="{Binding Title}" FontSize="28" />
                </Expander.Header>
                <ItemsControl ItemsSource="{Binding Children}" />
            </Expander>
        </DataTemplate>
        <DataTemplate DataType="{x:Type m:SettingText}">
            <Grid Classes="SettingLineBox" ColumnDefinitions="Auto,Auto,*" Margin="8 4" VerticalAlignment="Center"
                  ColumnSpacing="16">
                <TextBlock Classes="SettingLineCaption" />
                <TextBox Classes="SLV" Grid.Column="1" Text="{Binding Value}" />
            </Grid>
        </DataTemplate>
        <DataTemplate DataType="{x:Type m:SettingInteger}">
            <Grid Classes="SettingLineBox" ColumnDefinitions="Auto,Auto,*" Margin="8 4" VerticalAlignment="Center"
                  ColumnSpacing="16">
                <TextBlock Classes="SettingLineCaption" />
                <u:NumericLongUpDown Grid.Column="1" Classes="SLV" Value="{Binding Value}"
                                     Minimum="{Binding MinValue}"
                                     Maximum="{Binding MaxValue}" />
            </Grid>
        </DataTemplate>
        <DataTemplate DataType="{x:Type m:SettingReal}">
            <Grid Classes="SettingLineBox" ColumnDefinitions="Auto,Auto,*" Margin="8 4" VerticalAlignment="Center"
                  ColumnSpacing="16">
                <TextBlock Classes="SettingLineCaption" />
                <u:NumericDoubleUpDown Grid.Column="1" Classes="SLV" Value="{Binding Value}"
                                       Minimum="{Binding MinValue}"
                                       Maximum="{Binding MaxValue}" />
            </Grid>
        </DataTemplate>
        <DataTemplate DataType="{x:Type m:SettingSwitch}">
            <Grid Classes="SettingLineBox" ColumnDefinitions="Auto,Auto,*" Margin="8 4" VerticalAlignment="Center"
                  ColumnSpacing="16">
                <TextBlock Classes="SettingLineCaption" />
                <ToggleSwitch Grid.Column="1" Classes="SLV" IsChecked="{Binding Value}"
                          VerticalAlignment="Center" OnContent="" OffContent=""
                          HorizontalContentAlignment="Left" />
            </Grid>
        </DataTemplate>
        <DataTemplate DataType="{x:Type m:SettingChoice}">
            <Grid Classes="SettingLineBox" ColumnDefinitions="Auto,Auto,*" Margin="8 4" VerticalAlignment="Center"
                  ColumnSpacing="16">
                <TextBlock Classes="SettingLineCaption" />
                <ComboBox Grid.Column="1" Classes="SLV Bordered" SelectedIndex="{Binding SelectedIndex}"
                          ItemsSource="{Binding Options}" />
            </Grid>
        </DataTemplate>
    </u:UrsaView.DataTemplates>

    <!-- 样式 -->
    <u:UrsaView.Styles>
        <Style Selector="Grid.SettingLineBox">
            <Setter Property="MinWidth" Value="450" />
        </Style>
        <Style Selector="TextBlock.SettingLineCaption">
            <Setter Property="Width" Value="160" />
            <Setter Property="FontSize" Value="22" />
            <Setter Property="TextAlignment" Value="Right" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Text" Value="{Binding Title, StringFormat='{}: '}" />
        </Style>
        <Style Selector="Expander">
            <Setter Property="HorizontalAlignment" Value="Stretch" />
            <Style Selector="^ TextBlock.SectionHeader">
                <Setter Property="HorizontalAlignment" Value="Stretch" />
                <Setter Property="Foreground" Value="{DynamicResource ToggleSwitchContainerCheckedDefaultBackground}" />
            </Style>
        </Style>
        <Style Selector="TextBox.SLV, ToggleSwitch.SLV, ComboBox.SLV">
            <Setter Property="Width" Value="240" />
        </Style>
        <Style Selector="u|NumericLongUpDown, u|NumericDoubleUpDown">
            <Setter Property="Width" Value="240" />
        </Style>
    </u:UrsaView.Styles>

    <!-- 内容 -->
    <Grid RowDefinitions="*,Auto">
        <ItemsControl ItemsSource="{Binding SettingsTree.Children}"/>
        <Border Grid.Row="1" BorderThickness="0 4 0 0"
                BorderBrush="{DynamicResource GridSplitterBackground}">
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Center" Spacing="16"
                        Margin="32  8 32 0">
                <Button Classes="Large Danger" Content="还原配置" Command="{Binding LoadCommand}" />
                <Button Classes="Large Primary" Content="保存配置" Command="{Binding SaveCommand}" />
            </StackPanel>
        </Border>
    </Grid>
</u:UrsaView>