<u:UrsaWindow xmlns="https://github.com/avaloniaui"
              xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
              xmlns:vm="using:Diary.App.ViewModels"
              xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
              xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
              xmlns:u="https://irihi.tech/ursa"
              xmlns:app="using:Diary.App"
              xmlns:i="https://github.com/projektanker/icons.avalonia"
              xmlns:constants="clr-namespace:Diary.Core.Constants"
              xmlns:views="clr-namespace:Diary.App.Views"
              mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
              x:Class="Diary.App.Views.MainWindow"
              x:DataType="vm:MainWindowViewModel"
              WindowStartupLocation="CenterScreen"
              TitleBarMargin="0"
              MinWidth="1024"
              MinHeight="768"
              Width="1280"
              Height="800"
              Icon="/Assets/Icons/diary-app.ico"
              Title="Diary Tools NG"
              ActualThemeVariantChanged="OnActualThemeVariantChanged"
              Loaded="OnLoaded">
    <Interaction.Behaviors>
        <EventTriggerBehavior EventName="Closing">
            <InvokeCommandAction Command="{Binding ClosingCommand}" PassEventArgsToCommand="True" />
        </EventTriggerBehavior>
        <EventTriggerBehavior EventName="Opened">
            <InvokeCommandAction Command="{Binding OpenedCommand}" PassEventArgsToCommand="True" />
        </EventTriggerBehavior>
    </Interaction.Behaviors>


    <!-- 控件样式覆盖 -->
    <u:UrsaWindow.Styles>
        <!-- 底部展开折叠按钮 -->
        <Style Selector="ToggleButton#PanelOpen">
            <Setter Property="Background" Value="Transparent" />
            <Style Selector="^ i|Icon">
                <Setter Property="Foreground" Value="{DynamicResource ButtonDefaultPrimaryForeground}" />
            </Style>
            <Style Selector="^:checked i|Icon">
                <Setter Property="Foreground" Value="{DynamicResource ButtonSolidForeground}" />
                <Setter Property="Value" Value="mdi-arrow-left-thin-circle-outline" />
            </Style>
            <Style Selector="^:unchecked i|Icon">
                <Setter Property="Value" Value="mdi-arrow-right-thin-circle-outline" />
            </Style>
        </Style>

        <!-- 左侧列表项 -->
        <Style Selector="#ViewList u|SelectionListItem">
            <Setter Property="Padding" Value="0" />
            <Style Selector="^:selected i|Icon">
                <Setter Property="Foreground" Value="{DynamicResource ButtonDefaultPrimaryForeground}" />
            </Style>
            <Style Selector="^:selected TextBlock.ViewName">
                <Setter Property="Foreground" Value="{DynamicResource ButtonDefaultPrimaryForeground}" />
            </Style>
            <Style Selector="^:pointerover">
                <Setter Property="Background" Value="{DynamicResource ListBoxItemPointeroverBackground}" />
            </Style>
        </Style>

        <!-- 标题栏 -->
        <Style Selector="u|TitleBar">
            <Setter Property="Template">
                <ControlTemplate>
                    <ThemeVariantScope x:Name="TitleBarThemeScope">
                        <Panel Background="{DynamicResource WindowDefaultBackground}">
                            <u:WindowThumb Background="{TemplateBinding Background}" />
                            <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                                <ContentPresenter Grid.Column="0" Content="{TemplateBinding LeftContent}" />
                                <ContentPresenter Grid.Column="1" IsHitTestVisible="{TemplateBinding IsHitTestVisible}"
                                                  Content="{TemplateBinding Content}" />
                                <ContentPresenter Grid.Column="2" Content="{TemplateBinding RightContent}" />
                                <u:CaptionButtons Grid.Column="3" Name="PART_CaptionButtons" />
                            </Grid>
                        </Panel>
                    </ThemeVariantScope>
                </ControlTemplate>
            </Setter>
        </Style>
        
        <Style Selector="views|StatusBarView">
            <Setter Property="Template">
                <ControlTemplate>
                    <ThemeVariantScope x:Name="StatusBarThemeScope">
                        <ContentPresenter Content="{TemplateBinding Content}" 
                                          Background="{DynamicResource WindowDefaultBackground}"/>
                    </ThemeVariantScope>
                </ControlTemplate>
            </Setter>
        </Style>

        <Style Selector="Button#Version">
            <Setter Property="Background" Value="Transparent" />
            <Style Selector="^:pointerover">
                <Setter Property="Background" Value="Transparent" />
            </Style>
            <Style Selector="^:pressed">
                <Setter Property="Background" Value="Transparent" />
            </Style>
        </Style>
    </u:UrsaWindow.Styles>

    <!-- IDE预览 -->
    <Design.DataContext>
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <!-- 标题栏 -->
    <u:UrsaWindow.TitleBarContent>
        <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto" Height="32" Margin="4 0" ColumnSpacing="0">
            <Button Grid.Column="0" Margin="0" Padding="0" BorderThickness="0"
                    Background="Transparent">
                <Image Source="/Assets/Icons/diary-app.ico" Width="32" Height="32" />
                <Button.Flyout>
                    <MenuFlyout>
                        <MenuItem Header="关于" Command="{Binding ShowAboutCommand}" />
                        <Separator />
                        <MenuItem Header="最大化" Command="{Binding MaximizedCommand}" />
                        <MenuItem Header="最小化" Command="{Binding MinimizedCommand}" />
                        <Separator />
                        <MenuItem Header="退出" Command="{Binding QuitCommand}" />
                    </MenuFlyout>
                </Button.Flyout>
            </Button>
            <TextBlock Grid.Column="1" Text="{Binding $parent[u:UrsaWindow].Title}" FontSize="26" TextAlignment="Left"
                       VerticalAlignment="Center" IsHitTestVisible="False" FontWeight="Bold" />
            <Button Grid.Column="2" Content="{Binding VersionString}" IsEnabled="True"
                    VerticalAlignment="Center" ToolTip.Tip="{Binding VersionDetails}"
                    Padding="16 4" ToolTip.ShowDelay="250" Classes="Flat Success" Name="Version">
                <Button.Flyout>
                    <MenuFlyout>
                        <MenuItem Header="复制版本号" Command="{Binding CopyVersionCommand}"
                                  CommandParameter="{x:True}" />
                        <MenuItem Header="复制详细信息" Command="{Binding CopyVersionCommand}"
                                  CommandParameter="{x:False}" />
                    </MenuFlyout>
                </Button.Flyout>
            </Button>
            <Button Grid.Column="4" Classes="Success ActionButton" Command="{Binding ShowSettingsCommand}"
                    Theme="{DynamicResource BorderlessButton}"
                    ToolTip.Tip="程序设置" ToolTip.ShowDelay="250" Width="32" Height="32" Padding="0" BorderThickness="0"
                    Background="Transparent" HotKey="Alt+S">
                <i:Icon Value="mdi-cog-outline" />
            </Button>
            <u:ThemeToggleButton Grid.Column="3" IsThreeState="False" Mode="Indicator" />
        </Grid>
    </u:UrsaWindow.TitleBarContent>

    <DockPanel Margin="0 32 0 0">
        <!-- 状态栏 -->
        <views:StatusBarView Name="StatusBarView" DockPanel.Dock="Bottom" DataContext="{Binding StatusBar}"/>
        <Border Height="2" BorderThickness="0 0 0 2" BorderBrush="{DynamicResource SemiColorFocusBorder}"
                DockPanel.Dock="Bottom"/>
        <!-- 主内容 -->
        <SplitView Padding="4" DisplayMode="CompactOverlay" OpenPaneLength="256" CompactPaneLength="64"
                   IsPaneOpen="{Binding #PanelOpen.IsChecked, Mode=TwoWay}"
                   PanePlacement="Left">
            <SplitView.Pane>
                <Grid RowDefinitions="*,Auto">
                    <u:SelectionList Name="ViewList" ItemsSource="{Binding Pages}"
                                     HorizontalAlignment="Stretch" SelectedItem="{Binding SelectedPage}">
                        <u:SelectionList.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Width="240"
                                            VerticalAlignment="Center" Spacing="8" Margin="8 4"
                                            ToolTip.Tip="{Binding Name}"
                                            ToolTip.ShowDelay="150" Background="Transparent">
                                    <i:Icon Value="{Binding Icon}" FontSize="48" />
                                    <TextBlock FontSize="26" Text="{Binding Name}" Classes="ViewName"
                                               TextAlignment="Left" VerticalAlignment="Center" />
                                </StackPanel>
                            </DataTemplate>
                        </u:SelectionList.ItemTemplate>
                        <u:SelectionList.Indicator>
                            <x:Null />
                        </u:SelectionList.Indicator>
                    </u:SelectionList>
                    <ToggleButton Name="PanelOpen" Grid.Row="1" HorizontalAlignment="Stretch"
                                  BorderThickness="0" Padding="0">
                        <StackPanel Spacing="8" Orientation="Horizontal" HorizontalAlignment="Left">
                            <i:Icon FontSize="48" HorizontalAlignment="Left" />
                        </StackPanel>
                    </ToggleButton>
                </Grid>
            </SplitView.Pane>
            <ContentControl Content="{Binding CurrentPageModel}"
                            Padding="8">
                <ContentControl.ContentTemplate>
                    <app:ViewLocator />
                </ContentControl.ContentTemplate>
            </ContentControl>
        </SplitView>
    </DockPanel>
</u:UrsaWindow>